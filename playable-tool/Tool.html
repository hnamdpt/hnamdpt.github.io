<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tool</title>
	<script type="text/javascript" src="jquery-3.4.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="bootstrap.min.css">
	<style type="text/css">
		*{
			margin: 0px;
			padding: 0px;
		}
		.row{
			margin: 0px !important;
		}
		.footer{
			position: fixed;
			bottom: 0;
			background: #f46200 !important;
			padding-left: 5px;
			padding-right:5px;
		}
	</style>
</head>
<body>
	<div  class="alert alert-dark" role="alert" style="text-align: center;font-weight: bold">
		<h3 style="font-weight: bold">PLAYABLE ADS TOOL</h3>
	</div>

	<div class = 'row'>
			<div class = "col-md-6">
				<div id = "tit" class="alert alert-danger" role="alert">
					<span >Source</span>
				</div>
				<textarea class="" id="ms_word_filtered_html" style = "width:100%;height:500px;">
				</textarea>
			</div>
			<div class = "col-md-6">
				<div id = "tit" class="alert alert-success" role="alert">
					<span id = "selected">Result</span>
				</div>
				<textarea class="" id="ms_word_filtered_html_2" style = "width:100%;height:500px;"></textarea>
			</div>

	</div>
	
	<!-- <p>Click Network you want then click "Dowload File"</p> -->
	<div id = "list-btn" style="padding: 10px;">
		<form enctype="multipart/form-data">
			<input id="upload" type=file   accept="text/html" name="files[]" size=30>
		</form>

		<div class="alert alert-primary" role="alert" style="margin-top:10px;">
			Select your file and click network you want then click "Dowload File"
		</div>
		<button id = "unity"  class="btn btn-dark">Unity</button>
		<button id = "facebook"  class="btn btn-primary">Facebook</button>
		<button id = "google" class="btn btn-danger">Google</button>
		<button id = "applovin"  class="btn btn-info">Applovin</button>
		<button id = "adcolony"  class="btn btn-warning">Adcolony</button>
		<button id = "vungle"  class="btn btn-secondary" >Vungle</button>
		<button id = "ironsource" class="btn btn-success">Ironsource</button>
	</div>
	<div class = "down" style="padding: 10px;">
		<a href="" id="a" class="btn btn-secondary">Dowload File</a>
	</div>
		
	<div class = 'footer btn-secondary'>
		<span>@HaiNam - ABI Game Studio</span>
	</div>

	<script type="text/javascript">

		$("#ms_word_filtered_html").val(`<!DOCTYPE html>
			<html>
				<head>
					<meta name=viewport content="width=device-width,
					 initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
					<meta name="apple-mobile-web-app-capable" content="yes" />
					<meta charset="utf-8">
					<title>Template example || follow it  to convert code to all Network</title>
				</head>
				<body>
					<!-- Need a tag <div id = "game"></div> -->
					<div id = "game"></div>
					
					<script type="text/javascript">
							// add comment //startgame like below to covert to Ironsource
							//startgame	
							var width_game = window.innerWidth;
							var height_game = window.innerHeight;
							var dpr = window.devicePixelRatio;
							var userAgent = navigator.userAgent || navigator.vendor || window.opera;
							var linkDownload =
							 "https://play.google.com/store/apps/details?id=com.abistudio.jigsaw.blast";
							var operatingsystem = "";
							if (/android/i.test(userAgent)) {
								operatingsystem = "Android";
								linkDownload = 
								"https://play.google.com/store/apps/details?id=com.abistudio.jigsaw.blast";
							}
							if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
								operatingsystem = "iOS";
								linkDownload =
								'https://play.google.com/store/apps/details?id=com.abistudio.jigsaw.blast';
							}
							var isLandscape = false;
							var ratio = width_game/height_game;
							if(width_game>height_game){
								isLandscape = true;
							}
							function CTAClick(){
								window.open(linkDownload);
							}
							function loadGamePlay(){
									// code game here
							}
					<\/script>
				</body>
			</html>`);

			var fileContent;
			var fileName;
			function handleFileSelect(evt) {
			var files = evt.target.files; // FileList object

			// use the 1st file from the list
			f = files[0];

			var reader = new FileReader();

			// Closure to capture the file information.
			console.log(f);
			fileName = f.name;
			reader.onload = (function(theFile) {
			return function(e) {

			jQuery( '#ms_word_filtered_html' ).val( e.target.result );
			// console.log(e);
			content = $("#ms_word_filtered_html").val();
		};
		})(f);

		// Read in the image file as a data URL.
		reader.readAsText(f);
		}

		document.getElementById('upload').addEventListener('change', handleFileSelect, false);

		function download(text, name, type) {
		var a = document.getElementById("a");
		var file = new Blob([text], {type: type});
		a.href = URL.createObjectURL(file);
		a.download = name;
		}

		var unity = $("#unity");
		var applovin = $("#applovin");
		var adcolony = $("#adcolony");
		var unity = $("#unity");
		var vungle = $("#vungle");
		var facebook = $("#facebook");
		var google = $("#google");

		var ironsource = $("#ironsource");
		unity.click(function(){
		changeCTA("unity");
		});
		applovin.click(function(){
		changeCTA("applovin");
		})
		adcolony.click(function(){
		changeCTA("adcolony");
		})
		vungle.click(function(){
		changeCTA("vungle");
		});

		facebook.click(function(){
		changeCTA("facebook");
		});
		google.click(function(){
		changeCTA("google");
		});

		ironsource.click(function(){
		changeCTA("ironsource");
		});

		function changeCTA(net){
		$("#a").removeClass("btn-success");
		var content = $("#ms_word_filtered_html").val(); 
		if(fileName!=null){
			var name = fileName.slice(0,fileName.length-4);
		}
		
		switch(net){
		case "unity":
			
			var find ='window.open(linkDownload)';
			var htmlContent = replaceAll(content,find,'mraid.open(linkDownload)');
			download(htmlContent,name+ "_Unity.html","text/plain");
			$("#ms_word_filtered_html_2").val(htmlContent);
			$("#selected").html("Unity");
		break;
		case "facebook":
			var find ='window.open(linkDownload)';
			var htmlContent = replaceAll(content,find,'FbPlayableAd.onCTAClick()');
			download(htmlContent,name+ "_Facebok.html","text/plain");
			$("#ms_word_filtered_html_2").val(htmlContent);
			$("#selected").html("Facebook");
		break;
		case "applovin":
			var find ='window.open(linkDownload)';
			var htmlContent = replaceAll(content,find,'mraid.open(linkDownload)');
			download(htmlContent,name+ "_Applovin.html","text/plain");
		$("#ms_word_filtered_html_2").val(htmlContent);
				$("#selected").html("Applovin");
		break;
		case "adcolony":
			var find ='window.open(linkDownload)';
			var htmlContent = replaceAll(content,find,'mraid.open(linkDownload)');
				download(htmlContent,name+ "_Adcolony.html","text/plain");
			$("#ms_word_filtered_html_2").val(htmlContent);
					$("#selected").html("Adcolony");
		break;
		case "vungle":
			var find ='window.open(linkDownload)';
			var htmlContent = replaceAll(content,find,'callSDK("download")');
			var find2 = 'window.innerWidth';
			var htmlContent =replaceAll(htmlContent,find2,'document.body.clientWidth');
			var find3 = 'window.innerWidth';
			var htmlContent = replaceAll(htmlContent,find3,'document.body.clientHeight');
			download(htmlContent,name+ "_Vungle.html","text/plain");
			$("#ms_word_filtered_html_2").val(htmlContent);
					$("#selected").html("Vungle");
		break;
		case "google":
			var find ='<title>';
			if(content.includes("https://tpc.googlesyndication.com/pagead/gadgets/html5/api/exitapi.js")==false){
			var htmlContent = replaceAll(content,find,'\n<meta name="ad.size" content="width=480,height=320">\n<script type="text/javascript"src="https://tpc.googlesyndication.com/pagead/gadgets/html5/api/exitapi.js"> <\/script>\n<title>');
			}

			var find2 = 'window.open(linkDownload)';
			var htmlContent =replaceAll(htmlContent,find2,'ExitApi.exit()');
			download(htmlContent,name+ "_Google.html","text/plain");
			$("#ms_word_filtered_html_2").val(htmlContent);
					$("#selected").html("Google");
		break;
		case "ironsource":
		var find1 = '<div id = "game"></div>';
		var htmlContent = replaceAll(content,find1,`<div id = "game"></div>\n<script type="text/javascript">
			function getScript(e,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,i&&(n.onload=i),n.src=e,document.head.appendChild(n)}function parseMessage(e){var i=e.data,n=i.indexOf(DOLLAR_PREFIX+RECEIVE_MSG_PREFIX);if(-1!==n){var t=i.slice(n+2);return getMessageParams(t)}return{}}function getMessageParams(e){var i,n=[],t=e.split("/"),a=t.length;if(-1===e.indexOf(RECEIVE_MSG_PREFIX)){if(a>=2&&a%2===0)for(i=0;a>i;i+=2)n[t[i]]=t.length<i+1?null:decodeURIComponent(t[i+1])}else{var o=e.split(RECEIVE_MSG_PREFIX);void 0!==o[1]&&(n=JSON&&JSON.parse(o[1]))}return n}function getDapi(e){var i=parseMessage(e);if(!i||i.name===GET_DAPI_URL_MSG_NAME){var n=i.data;getScript(n,onDapiReceived)}}function invokeDapiListeners(){for(var e in dapiEventsPool)dapiEventsPool.hasOwnProperty(e)&&dapi.addEventListener(e,dapiEventsPool[e])}function onDapiReceived(){dapi=window.dapi,window.removeEventListener("message",getDapi),invokeDapiListeners()}function init(){window.dapi.isDemoDapi&&(window.parent.postMessage(DOLLAR_PREFIX+SEND_MSG_PREFIX+JSON.stringify({state:"getDapiUrl"}),"*"),window.addEventListener("message",getDapi,!1))}var DOLLAR_PREFIX="$$$",RECEIVE_MSG_PREFIX="DAPI_SERVICE:",SEND_MSG_PREFIX="DAPI_AD:",GET_DAPI_URL_MSG_NAME="connection.getDapiUrl",dapiEventsPool={},dapi=window.dapi||{isReady:function(){return!1},addEventListener:function(e,i){dapiEventsPool[e]=i},removeEventListener:function(e){delete dapiEventsPool[e]},isDemoDapi:!0};init();
			<\/script>`);

		var find2 = '//startgame';
		var htmlContent = replaceAll(htmlContent,find2,`//start game\nvar isFirstLoad = true;
			window.onload = function(){
				(dapi.isReady()) ? onReadyCallback() : dapi.addEventListener("ready", onReadyCallback);	
			}
			function onReadyCallback(){
				dapi.removeEventListener("ready", onReadyCallback);
				let isAudioEnabled = !!dapi.getAudioVolume();

				if(dapi.isViewable()){
					adVisibleCallback({isViewable: true});
				}
				dapi.addEventListener("viewableChange", adVisibleCallback);
				dapi.addEventListener("adResized", adResizeCallback);
				dapi.addEventListener("audioVolumeChange",audioVolumeChangeCallback);

			}
			function adVisibleCallback(event){
				console.log("isViewable " + event.isViewable);

				if (event.isViewable){
					screenSize = dapi.getScreenSize();
					if(isFirstLoad){
						loadGamePlay();
						isFirstLoad = false;
					}
				} else {
					//PAUSE the ad and MUTE sounds
				}
			}
			function adResizeCallback(event){
				screenSize = event;
				// document.getElementById("log2").innerHTML = "game: "+game.width + "x"+game.height + "screen: "+window.innerWidth+"x"+window.innerHeight +"DAPI: "+ dapi.getScreenSize().width + "x"+ dapi.getScreenSize().height;
				game.scale.refresh();
			}

			//When user clicks on the download button - use openStoreUrl function
			function userClickedDownloadButton(event){
				dapi.openStoreUrl();
			}

			function audioVolumeChangeCallback(volume){
				let isAudioEnabled = !!volume;
				if (isAudioEnabled){
					//START or turn on the sound
				} else {
					//PAUSE the turn off the sound
				}
			}`);

		var find3 = 'window.open(linkDownload)';

		var htmlContent = replaceAll(htmlContent,find3,'dapi.openStoreUrl()');

		download(htmlContent,name+ "_Ironsource.html","text/plain");
				$("#selected").html("Ironsource");

		$("#ms_word_filtered_html_2").val(htmlContent);
		break;
		}
		$("#a").addClass( "btn btn-success" );
		}
		function replaceAll(str, find, replace) {
			return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
		}
		function escapeRegExp(str) {
			return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
		}
</script>
</body>
</html>